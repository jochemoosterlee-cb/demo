<!DOCTYPE html>
<html lang="en" class="overflow-x-hidden">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="manifest" href="manifest.json">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link href="https://fonts.googleapis.com/css2?family=Headland+One&family=Inter:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="./html5-qrcode.min.js"></script> <!-- Local file -->

  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            inter: ['Inter', 'sans-serif'],
            headland: ['"Headland One"', 'serif'],
          },
          colors: {
            brandBg: '#FAF5EB',
            textDark: '#222',
            cardBg: '#F7EFDD',
            brandBlue: '#163563',
            brandBlueHover: '#003d8c',
          },
        },
      },
    };
  </script>

  <title>Demo</title>
</head>

<body class="overflow-x-hidden bg-brandBg text-textDark flex flex-col items-center justify-start py-8 px-4">
  <h1 class="font-headland text-[1.4rem] font-medium mb-4">Scan de QR-code</h1>
  <button id="scanButton" class="bg-brandBlue hover:bg-brandBlueHover text-white rounded-md px-6 py-3 text-base font-inter mt-10 inline-flex items-center gap-2 transition-colors duration-200">
    Scan QR
    <span><strong>&gt;</strong></span>
  </button>
  <div id="reader" class="mt-10 hidden"></div>
</body>

<script type="module">
  import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
  import { getDatabase, ref, set } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js';

  const firebaseConfig = {
    databaseURL: "https://demoapp-6cc2a-default-rtdb.europe-west1.firebasedatabase.app/"
  };
  const app = initializeApp(firebaseConfig);
  const database = getDatabase(app);

  const scanButton = document.getElementById('scanButton');
  const reader = document.getElementById('reader');
  let html5QrcodeScanner;

  // Wait for library to load
  window.addEventListener('load', () => {
    if (typeof Html5QrcodeScanner === 'undefined') {
      console.error('Html5QrcodeScanner still not defined after load');
      return;
    }

    scanButton.addEventListener('click', () => {
      scanButton.classList.add('hidden');
      reader.classList.remove('hidden');
      html5QrcodeScanner = new Html5QrcodeScanner('reader', {
        fps: 10,
        qrbox: { width: 250, height: 250 }, // Match documentation example
      });
      html5QrcodeScanner.render((qrCodeMessage) => {
        html5QrcodeScanner.clear();
        reader.classList.add('hidden');
        set(ref(database, 'qrScanned'), qrCodeMessage);
        scanButton.classList.remove('hidden'); // Re-enable button
      }, (error) => {
        console.log('QR Scan Error:', error);
      });
    });
  });

  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('sw.js');
  }
</script>
</html>